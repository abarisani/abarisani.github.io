<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>oCERT archive</title>
    <link rel="icon" href="/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="stylesheet" href="../../styles/prism.css">
    <link rel="stylesheet" href="../../styles/hack.css?t=1473587248287">
    <link rel="stylesheet" href="../../styles/site.css?t=1473587248286">
  </head>
  <body class="hack">
    <div class="main container">

    <p><b>#2008-012 Horde, Popoon frameworks common input sanitization errors (XSS)</b></p>

    <p><b>Description</b>:</p>

    <p>Two cross-site scripting (XSS) vulnerabilities were reported in Horde Framework.
       The first of which is that the Horde framework fails to properly
       sanitize the filename of MIME attachments on received emails.  The second
       vulnerability has a wider impact.</p>

    <p>Horde relies on code similar to Popoon's externalinput.php to filter out
       potential XSS attacks on user-supplied input.  This filter, and the original,
       fail to fully sanitize user data.  In particular, this filter fails to
       protect against '/'s acting as spaces in both Microsoft Internet Explorer and
       Mozilla Firefox.</p>

    <p>For example, the following snippet, supplied by the reporter, is treated as
       valid by the browsers but safe by the filter: &lt;body/onload=alert(/w00w00/)&gt; </p>

    <p>Patches have been made available for Horde:</p>

    <p>* 3.1: <a href="../patches/2008-012/Text_Filter.31.patch">Text_Filter.31.patch</a></p>
    <p>* 3.2 - CVS HEAD: <a href="../patches/2008-012/MIME.patch">MIME.patch</a>, <a href="../patches/2008-012/Text_Filter.patch">Text_Filter.patch</a></p>

    <p>A fixed version of externalinput.php is linked below as well.</p>

    <p><b>Affected version</b>:</p>

    <p><a href="http://horde.org">Horde</a> &gt;= 3.2, &lt;= 3.2.1 (both issues)</p>

    <p><a href="http://horde.org">Horde</a> &gt;= 3.1, &lt; 3.2 (XSS filter only)</p>

    <p><a href="http://svn.bitflux.ch/repos/public/popoon/trunk/classes/externalinput.php">externalinput.php</a> from <a href="http://wiki.flux-cms.org/display/FLX/Popoon">Popoon</a> &lt;= r22196.</p>

    <p>(secondary affected versions)</p>

    <p><a href="http://horde.org/groupware">Horde Groupware</a>  &gt;= 1.0, &lt;= 1.0.6 (XSS filter only)</p>

    <p><a href="http://horde.org/groupware">Horde Groupware Webmail Edition</a>  &gt;= 1.0, &lt;= 1.0.7 (XSS filter only)</p>

    <p><a href="http://horde.org/groupware">Horde Groupware</a>  &gt;= 1.1, &lt;= 1.1.2 (both issues)</p>

    <p><a href="http://horde.org/groupware">Horde Groupware Webmail Edition</a>  &gt;= 1.1, &lt;= 1.1.2 (both issues)</p>

    <p><a href="http://www.cakephp.org">Cake-PHP</a> &lt;= 1.2.0.7296 RC2</p>

    <p><a href="http://www.phpmyfaq.de">phpMyFaq</a> &lt;= 2.5.0-dev</p>

    <p><a href="http://www.deluxebb.com">deluxeBB</a> &lt;= 1.2</p>

    <p><a href="http://www.emusoft.org/index.php?page=category&cat_id=14">emuCMS</a> &lt;= 0.3</p>

    <p><a href="http://dev.mistralys.com/SimpleSite">SimpleSite</a> &lt;= 1.6.4</p>

    <p><a href="http://sourceforge.net/projects/revokebb">RevokeBB</a> &lt;= 1.0RC11_normal</p>

    <p><a href="http://tpln.h2lsoft.com/">TPLN</a> &lt;= 2.9</p>

    <p><a href="http://code.google.com/p/logicoder/">Logicoder</a> &lt;= r27</p>

    <p><a href="http://code.google.com/p/phour/">phour</a> &lt;= r106</p>

    <p><a href="http://www.maxdev.com/AboutMD.phtml">MDPro</a> &lt;= 1.0821</p>

    <p><a href="http://code.google.com/p/noserub/">noserub</a> &lt;= r784, 0.6 [CakePHP user]</p>


    <p><b>Fixed version</b>:</p>

    <p><a href="https://svn.liip.ch/repos/public/ext/externalinput/trunk/lx/externalinput/clean.php">externalinput.php</a> (now clean.php) &gt;= 200809010</p>

    <p><a href="http://horde.org">Horde</a> &gt; 3.2.1</p>

    <p><a href="http://www.phpmyfaq.de">phpMyFaq</a> &gt;= 2.0.8, 2.5.0-dev (svn-20080911)</p>

    <p><b>Credit</b>: vulnerability report and proof of concepts received from Alexios Fakos &lt;security [at] nruns [dot] com&gt;.
    </p>

    <p><b>CVE</b>:
    <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-3823">CVE-2008-3823</a> (MIME attachment),
    <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-3824">CVE-2008-3824</a> (XSS filtering)</p>

    <b>Timeline</b>:

    <p>2008-08-05: initial report and proof of concepts received<br/>
    2008-08-18: affected software survey completed by oCERT<br/>
    2008-08-18: externalinput.php/Popoon author contacted<br/>
    2008-08-19: Horde author contacted<br/>
    2008-08-19: initial patches for Horde and Popoon supplied by vendors<br/>
    2008-08-19: reporter calls out additional possible vectors in externalinput.php<br/>
    2008-08-20: secondary fixed for externalinput.php supplied<br/>
    2008-08-20: attempted to contact CakePHP<br/>
    2008-09-04: final Horde patches supplied<br/>
    2008-09-04: potentially affected vendors notified<br/>
    2008-08-05: CVEs assigned<br/>
    2008-09-05: oCERT requests end of embargo to be Sep 10, 1700 UTC<br/>
    2008-09-06: contacted phlymail lite, confirmed unaffected<br/>
    2008-09-06: notified all secondary vendors above<br/>
    2008-09-06: acknowledgement from cakephp, noserub, phpmyfaq<br/>
    2008-09-09: confirmed exact embargo end with vendor-sec and other vendors<br/>
    2008-09-10: advisory released</p>

    <p><b>References</b>:<br/>
    <a href="http://blog.liip.ch/archive/2005/01/16/xss-how-we-try-to-prevent-it.html">http://blog.liip.ch/archive/2005/01/16/xss-how-we-try-to-prevent-it.html</a>
    <br/>
    <a href="http://blog.liip.ch/missed-case-in-externalinput-php-resulting-in-viable-xss-attacks.html">http://blog.liip.ch/missed-case-in-externalinput-php-resulting-in-viable-xss-attacks.html</a>
    <br/>
    <a href="http://www.nruns.com/security_advisory_horde_xss_in_filename_mime_attachments.php">n runs-SA-2008 006 Horde Cross-Site Scripting in filename MIME attachments</a>
    <br/>
    <a href="http://www.nruns.com/security_advisory_xss_filter_evasion_in_various_frameworks.php">n runs-SA-2008 007 Cross-Site Scripting Filter Evasion in various frameworks</a>
    </p>
</div>
</body>
</html>
