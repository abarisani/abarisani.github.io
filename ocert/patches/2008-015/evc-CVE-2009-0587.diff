--- addressbook/libebook/e-vcard.c.orig	2009-03-03 11:41:27.000000000 +0100
+++ addressbook/libebook/e-vcard.c	2009-03-03 11:44:10.000000000 +0100
@@ -2208,7 +2208,10 @@ _evc_base64_encode_simple (const char *d
 
 	g_return_val_if_fail (data != NULL, NULL);
 
-	out = g_malloc (len * 4 / 3 + 5);
+	if (len >= ((G_MAXSIZE - 1) / 4 - 1) * 3)
+		return NULL;
+
+	out = g_malloc ((len / 3 + 1) * 4 + 1);
 	outlen = _evc_base64_encode_close ((unsigned char *)data, len, FALSE,
 				      out, &state, &save);
 	out[outlen] = '\0';
