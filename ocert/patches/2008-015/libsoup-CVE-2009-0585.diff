--- libsoup-2.2.98/libsoup/soup-misc.c.orig	2009-02-27 16:57:14.000000000 +0100
+++ libsoup-2.2.98/libsoup/soup-misc.c	2009-02-27 21:40:57.000000000 +0100
@@ -219,7 +219,11 @@ soup_base64_encode (const char *text, in
         unsigned char *out;
         int state = 0, outlen,  save = 0;
         
-        out = g_malloc (len * 4 / 3 + 5);
+        if (len < 0)
+            g_error("%s: invalid Base64 encoding input length specified: %d",
+                G_STRLOC, len);
+
+        out = g_malloc ((len / 3 + 1) * 4 + 1);
         outlen = soup_base64_encode_close ((const guchar *)text,
 					   len, 
 					   FALSE,
